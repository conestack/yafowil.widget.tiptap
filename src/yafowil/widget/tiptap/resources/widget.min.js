!function(t,e,i){"use strict";class s{constructor(t,i){let s;this.elem=e("<div />").text(t).addClass("tiptap-tooltip").appendTo("body"),i.on("mouseover",(t=>{let e=`${i.offset().left+20}px`,n=`${i.offset().top+i.outerHeight()}px`;s=setTimeout((()=>{this.elem.css({left:e,top:n}),this.elem.fadeIn()}),500)})),i.on("mouseout",(t=>{clearTimeout(s),this.elem.fadeOut()}))}}class n{constructor(t,i={}){this.editor=t,this.editor_elem=e(t.options.element),this.elem=e("<button />").appendTo(i.container_elem),this.opts=i,i.tooltip&&new s(i.tooltip,this.elem),i.order&&this.elem.css("order",i.order),i.icon&&(this.icon=e("<i />").addClass(`glyphicon glyphicon-${i.icon}`).appendTo(this.elem)),i.text&&e("<span />").text(i.text).appendTo(this.elem),i.css&&e("> *",this.elem).css(i.css),this.content=e("> *",this.elem),this.container_elem=i.container_elem,this.on_click=this.on_click.bind(this),this.elem.on("click",this.on_click)}get active(){return this._active}set active(t){this.opts.toggle&&(t?this.elem.addClass("active"):this.elem.removeClass("active")),this._active=t}}class o extends n{constructor(t,i={}){super(t,i),this.elem.addClass("drop_btn"),this.dd_elem=e("<div />").addClass("tiptap-dropdown").appendTo("body"),this.children=[],i.submit&&(this.dd_elem.addClass("grid"),this.submit_elem=e("<button />").addClass("submit").text("submit").appendTo(this.dd_elem),this.submit=this.submit.bind(this),this.submit_elem.on("click",this.submit)),this.hide_dropdown=this.hide_dropdown.bind(this),e(document).on("click",this.hide_dropdown),this.on_resize=this.on_resize.bind(this),e(window).on("resize",this.on_resize)}get active_item(){return this._active_item}set active_item(t){let e=t.elem.children().clone();this.elem.empty().append(e),this.content&&this.elem.prepend(this.content),this.dd_elem.hide(),this._active_item=t}unload(){e(document).off("click",this.hide_dropdown),e(window).off("resize",this.on_resize)}on_resize(t){this.dd_elem.hide(),this.active=!1}set_items(){for(let t of this.children)t.elem.addClass("dropdown-item"),t.elem.on("click",(e=>{this.active_item=t}));this.active_item=this.children[0]}hide_dropdown(t){this.dd_elem.is(":visible")&&t.target!==this.dd_elem[0]&&t.target!==this.elem[0]&&0===e(t.target).closest(this.dd_elem).length&&0===e(t.target).closest(this.elem).length&&(this.dd_elem.hide(),this.active=!1)}on_click(t){t.preventDefault();let i=this.elem.offset().left,s=this.elem.outerWidth(),n=this.dd_elem.outerWidth(),o=e(window).width()-i-s<n?i-n+s:i;this.dd_elem.css("left",`${o}px`).css("top",`${this.elem.offset().top+this.elem.outerHeight()}px`).toggle()}}class l extends n{static extensions=[i.Bold];constructor(t,e,i){super(e,{container_elem:i.container_elem,text:"B",css:{"font-weight":"bold"},tooltip:"Toggle Bold",toggle:!0}),this.id="bold",this.widget_elem=t.elem}on_click(t){t.preventDefault(),this.active=!this.active,this.editor.chain().focus().toggleBold().run(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}class a extends n{static extensions=[i.Italic];constructor(t,e,i){super(e,{container_elem:i.container_elem,text:"i",css:{"font-style":"italic"},tooltip:"Toggle Italic",toggle:!0}),this.id="italic",this.widget_elem=t.elem}on_click(t){t.preventDefault(),this.active=!this.active,this.editor.chain().focus().toggleItalic().run(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}class d extends n{static extensions=[i.Underline];constructor(t,e,i){super(e,{container_elem:i.container_elem,text:"U",css:{"text-decoration":"underline"},tooltip:"Toggle Underline",toggle:!0}),this.id="underline",this.widget_elem=t.elem}on_click(t){t.preventDefault(),this.active=!this.active,this.editor.chain().focus().toggleUnderline().run(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}class r extends n{static extensions=[i.BulletList,i.ListItem];constructor(t,e,i){super(e,{container_elem:i.container_elem,icon:"list",tooltip:"Bullet List",toggle:!0}),this.id="bullet_list",this.widget_elem=t.elem}on_click(t){t.preventDefault(),this.active=!this.active,this.editor.chain().focus().toggleBulletList().run(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}class c extends n{static extensions=[i.OrderedList,i.ListItem];constructor(t,e,i){super(e,{container_elem:i.container_elem,icon:"th-list",tooltip:"Ordered List",toggle:!0}),this.id="ordered_list",this.widget_elem=t.elem}on_click(t){t.preventDefault(),this.active=!this.active,this.editor.chain().focus().toggleOrderedList().run(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}class h extends n{static extensions=[i.Blockquote];constructor(t,e,i){super(e,{container_elem:i.container_elem,icon:"indent-left",tooltip:"Indent"}),this.id="indent",this.widget_elem=t.elem}on_click(t){t.preventDefault(),this.editor.can().setBlockquote()&&this.editor.chain().focus().setBlockquote().run(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}class m extends n{static extensions=[i.Blockquote];constructor(t,e,i){super(e,{container_elem:i.container_elem,icon:"indent-right",tooltip:"Outdent"}),this.id="outdent",this.widget_elem=t.elem}on_click(t){t.preventDefault(),this.editor.can().unsetBlockquote()&&(this.editor.chain().focus().unsetBlockquote().run(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this})))}}class p extends n{static extensions=[i.Heading];constructor(t,e,i){super(e,{container_elem:i.container_elem,text:`Heading ${i.level}`}),this.id="heading",this.level=i.level,this.widget_elem=t.elem}on_click(t){t.preventDefault(),this.editor.chain().focus().toggleHeading({level:this.level}).run(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}class u extends n{constructor(t,e,i){super(e,{container_elem:i.container_elem,text:"Text"}),this.id="paragraph",this.widget_elem=t.elem}on_click(t){t.preventDefault(),this.editor.chain().focus().setParagraph().run(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}class _ extends n{constructor(t,e,i){super(e,{container_elem:i.container_elem,text:i.swatch.name}),this.id="color",this.swatch=i.swatch,this.widget_elem=t.elem,$("<div />").addClass("color").css("background-color",this.swatch.color).appendTo(this.elem)}on_click(t){t.preventDefault(),this.editor.chain().focus().setColor(this.swatch.color).run(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}class g extends o{static extensions=[i.Heading];constructor(t,e,i){super(e,{container_elem:i.container_elem,icon:"font"}),this.id="headings",this.children.push(new u(t,e,{container_elem:this.dd_elem}));for(let i=1;i<=6;i++)this.children.push(new p(t,e,{container_elem:this.dd_elem,level:i}));this.set_items()}reset(){this.active_item=this.children[0]}}class f extends o{static extensions=[i.Color];constructor(t,e,i){super(e,{container_elem:i.container_elem}),this.id="colors";for(let s of i.action_opts)this.children.push(new _(t,e,{container_elem:this.dd_elem,swatch:s}));this.set_items()}}class v extends o{static extensions=[i.Image];constructor(t,e,i){super(e,{container_elem:i.container_elem,tooltip:"Add Image",icon:"picture",submit:!0}),this.id="image",this.widget_elem=t.elem,this.src_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("src:")).append($('<input type="text" />')).prependTo(this.dd_elem),this.alt_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("alt:")).append($('<input type="text" />')).prependTo(this.dd_elem),this.title_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("title:")).append($('<input type="text" />')).prependTo(this.dd_elem)}submit(t){t.preventDefault(),this.editor.chain().focus().setImage({src:$("input",this.src_elem).val(),alt:$("input",this.alt_elem).val(),title:$("input",this.title_elem).val()}).run(),this.dd_elem.hide(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}class w extends o{static extensions=[i.Link];constructor(t,e,i){super(e,{container_elem:i.container_elem,tooltip:"Add Link",icon:"link",submit:!0}),this.id="link",this.widget_elem=t.elem,this.href_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("href:")).append($('<input type="text" />')).prependTo(this.dd_elem)}submit(t){t.preventDefault();let e=$("input",this.href_elem).val();this.editor.chain().focus().setLink({href:e}).run(),this.dd_elem.hide(),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}class x{constructor(t,e){this.name=t,this.elem=$("<div />").addClass(`btn-group ${t}`).appendTo(e)}}let b={bold:{factory:l},italic:{factory:a},underline:{factory:d},bullet_list:{factory:r},ordered_list:{factory:c},indent:{factory:h},outdent:{factory:m},html:{factory:class extends n{static extensions=[];constructor(t,e,i){super(e,{container_elem:i.container_elem,icon:"pencil",tooltip:"Edit HTML",toggle:!0}),this.id="html",this.widget_elem=t.elem,this.parent=this.elem.closest("div.tiptap-editor"),this.editarea=$("div.ProseMirror",this.parent),this.textarea=$("textarea.ProseMirror",this.parent)}on_click(t){t.preventDefault(),this.active=!this.active,this.active?($("button",this.parent).not(this.elem).prop("disabled",!0),this.editarea.hide(),this.textarea.show().text(this.editor.getHTML())):($("button",this.parent).prop("disabled",!1),this.textarea.hide(),this.editarea.show(),this.editor.chain().focus().setContent(this.textarea.val()).run()),this.widget_elem.trigger(new $.Event("tiptap-action",{action:this}))}}},heading:{factory:g},colors:{factory:f},image:{factory:v},link:{factory:w}};class k{static initialize(t){e("div.tiptap-editor",t).each((function(){new k(e(this),{heading:!0,colors:[{name:"Default",color:"#333333"},{name:"Blue",color:"#1a21fb"},{name:"Lime",color:"#ccff00"},{name:"Teal",color:"#2acaea"},{name:"Red",color:"#d0060a"}],bold:{target:"text_controls"},italic:{target:"text_controls"},underline:{target:"text_controls"},bullet_list:{target:"format_controls"},ordered_list:{target:"format_controls"},indent:{target:"format_controls"},outdent:{target:"format_controls"},html:!0,image:!0,link:!0})}))}constructor(t,s={}){this.elem=t,this.elem.data("tiptap-widget",this);let n=new Set([i.Document,i.Paragraph,i.Text,i.TextStyle,i.Dropcursor]);for(let t in s)b[t].factory.extensions.forEach((t=>n.add(t)));this.editarea=e("div.ProseMirror",this.elem),this.textarea=e("<textarea />").addClass("ProseMirror").appendTo(this.elem),this.controls=e("<div />").addClass("tiptap-controls").prependTo(this.elem),this.editor=new i.Editor({element:this.elem[0],extensions:n,content:"<p>Hello World!</p>"}),this.buttons=[];let o=[];for(let t in s){let e=s[t],i=b[t].factory,n=e.target,l=this.controls;if(n){let t=o.filter((t=>t.name===n??!1));if(t[0])l=t[0].elem;else{let t=new x(n,this.controls);o.push(t),l=t.elem}}this.buttons.push(new i(this,this.editor,{action_opts:e,container_elem:l}))}this.hide_all=this.hide_all.bind(this),this.editor.on("update",this.hide_all),this.editor.on("selectionUpdate",(()=>{})),this.on_event=this.on_event.bind(this),this.elem.on("tiptap-action",this.on_event),e(document).on("keyup",(t=>{let e=this.buttons.find((t=>"bullet_list"===t.id)),i=this.buttons.find((t=>"ordered_list"===t.id));if(!i&&!e)return;let s=this.buttons.find((t=>"bold"===t.id)),n=this.buttons.find((t=>"italic"===t.id)),o=this.buttons.find((t=>"underline"===t.id));"Enter"===t.key&&(e&&e.active||i&&i.active)&&(s&&s.active&&this.editor.commands.setBold(),n&&n.active&&this.editor.commands.setItalic(),o&&o.active&&this.editor.commands.setUnderline())}))}destroy(){this.unload_all(),this.editor.destroy(),this.elem.empty(),this.buttons=null}unload_all(){this.buttons.forEach((t=>{t.unload&&t.unload()}))}hide_all(){console.log("update"),e("div.tiptap-dropdown",this.elem).hide()}on_event(t){let e=t=>this.buttons.find((e=>e.id===t)),i=t=>{let e=this.buttons.find((e=>e.id===t));e&&(e.active=!1)};switch(t.action.id){case"bullet_list":i("ordered_list"),e("headings").reset();break;case"ordered_list":i("bullet_list"),e("headings").reset();break;case"paragraph":case"outdent":i("ordered_list"),i("bullet_list");break;case"heading":i("ordered_list"),i("bullet_list");let t=e("bold"),s=e("italic"),n=e("underline");t&&t.active&&this.editor.commands.setBold(),s&&s.active&&this.editor.commands.setItalic(),n&&n.active&&this.editor.commands.setUnderline()}}}e((function(){void 0!==window.ts?ts.ajax.register(k.initialize,!0):k.initialize()})),t.TiptapWidget=k,Object.defineProperty(t,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.tiptap=t}({},jQuery,tiptap);
//# sourceMappingURL=widget.min.js.map
