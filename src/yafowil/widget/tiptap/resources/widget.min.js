!function(e,t,i){"use strict";class s{constructor(e,i){let s;this.elem=t("<div />").text(e).addClass("tiptap-tooltip").appendTo("body"),i.on("mouseover",(e=>{let t=`${i.offset().left+20}px`,o=`${i.offset().top+i.outerHeight()}px`;s=setTimeout((()=>{this.elem.css({left:t,top:o}),this.elem.fadeIn()}),500)})),i.on("mouseout",(e=>{clearTimeout(s),this.elem.fadeOut()}))}}class o{constructor(e,i={}){this.editor=e,this.editor_elem=t(e.options.element),this.elem=t("<button />").appendTo(i.container_elem),this.opts=i,i.tooltip&&new s(i.tooltip,this.elem),i.order&&this.elem.css("order",i.order),i.icon&&(this.icon=t("<i />").addClass(`glyphicon glyphicon-${i.icon}`).appendTo(this.elem)),i.text&&t("<span />").text(i.text).appendTo(this.elem),i.css&&t("> *",this.elem).css(i.css),this.content=t("> *",this.elem),this.container_elem=i.container_elem,this.on_click=this.on_click.bind(this),this.elem.on("click",this.on_click)}get active(){return this._active}set active(e){e&&this.event&&this.editor_elem.trigger(this.event),this.opts.toggle&&(e?this.elem.addClass("active"):this.elem.removeClass("active")),this._active=e}on_click(e){e.preventDefault(),this.active=!this.active}}class n extends o{constructor(e,i={}){super(e,i),this.elem.addClass("drop_btn"),this.dd_elem=t("<div />").addClass("tiptap-dropdown").appendTo("body"),this.children=[],i.submit&&(this.dd_elem.addClass("grid"),this.submit_elem=t("<button />").addClass("submit").text("submit").appendTo(this.dd_elem),this.submit=this.submit.bind(this),this.submit_elem.on("click",this.submit)),this.hide_dropdown=this.hide_dropdown.bind(this),t(document).on("click",this.hide_dropdown),this.on_resize=this.on_resize.bind(this),t(window).on("resize",this.on_resize)}get active_item(){return this._active_item}set active_item(e){let t=e.elem.children().clone();this.elem.empty().append(t),this.content&&this.elem.prepend(this.content),this.dd_elem.hide(),this._active_item=e}unload(){t(document).off("click",this.hide_dropdown),t(window).off("resize",this.on_resize)}on_resize(e){this.dd_elem.hide()}set_items(){for(let e of this.children)e.elem.addClass("dropdown-item"),e.elem.on("click",(t=>{this.active_item=e}));this.active_item=this.children[0]}hide_dropdown(e){this.dd_elem.is(":visible")&&e.target!==this.dd_elem[0]&&e.target!==this.elem[0]&&0===t(e.target).closest(this.dd_elem).length&&0===t(e.target).closest(this.elem).length&&this.dd_elem.hide()}on_click(e){e.preventDefault();let i=this.elem.offset().left,s=this.elem.outerWidth(),o=this.dd_elem.outerWidth(),n=t(window).width()-i-s<o?i-o+s:i;this.dd_elem.css("left",`${n}px`).css("top",`${this.elem.offset().top+this.elem.outerHeight()}px`).toggle()}}class l extends o{constructor(e,t){super(e,{container_elem:t.container_elem,text:`Heading ${t.level}`}),this.level=t.level}on_click(e){super.on_click(e),this.editor.chain().focus().toggleHeading({level:this.level}).run()}}class a extends o{constructor(e,t){super(e,{container_elem:t.container_elem,text:"Text"}),this.event=new $.Event("tiptap-paragraph-action")}on_click(e){super.on_click(e),this.editor.chain().focus().setParagraph().run()}}class r extends o{constructor(e,t){super(e,{container_elem:t.container_elem,text:t.swatch.name}),this.swatch=t.swatch,$("<div />").addClass("color").css("background-color",this.swatch.color).appendTo(this.elem)}on_click(e){super.on_click(e),this.editor.chain().focus().setColor(this.swatch.color).run()}}class c{constructor(e,t){this.name=e,this.elem=$("<div />").addClass(`btn-group ${e}`).appendTo(t)}}let d={bold:{factory:class extends o{constructor(e,t){super(e,{container_elem:t.container_elem,text:"B",css:{"font-weight":"bold"},tooltip:"Toggle Bold",toggle:!0})}on_click(e){super.on_click(e),this.editor.chain().focus().toggleBold().run()}},extensions:[i.Bold]},italic:{factory:class extends o{constructor(e,t){super(e,{container_elem:t.container_elem,text:"i",css:{"font-style":"italic"},tooltip:"Toggle Italic",toggle:!0})}on_click(e){super.on_click(e),this.editor.chain().focus().toggleItalic().run()}},extensions:[i.Italic]},underline:{factory:class extends o{constructor(e,t){super(e,{container_elem:t.container_elem,text:"U",css:{"text-decoration":"underline"},tooltip:"Toggle Underline",toggle:!0})}on_click(e){super.on_click(e),this.editor.chain().focus().toggleUnderline().run()}},extensions:[i.Underline]},bullet_list:{factory:class extends o{constructor(e,t){super(e,{container_elem:t.container_elem,icon:"list",tooltip:"Bullet List",toggle:!0}),this.event=new $.Event("tiptap-bl-action"),this.editor_elem.on("\n            tiptap-ol-action\n            tiptap-paragraph-action\n            tiptap-outdent-action",(e=>{this.active=!1}))}on_click(e){super.on_click(e),this.editor.chain().focus().toggleBulletList().run()}},extensions:[i.BulletList,i.ListItem]},ordered_list:{factory:class extends o{constructor(e,t){super(e,{container_elem:t.container_elem,icon:"th-list",tooltip:"Ordered List",toggle:!0}),this.event=new $.Event("tiptap-ol-action"),this.editor_elem.on("\n            tiptap-bl-action\n            tiptap-paragraph-action\n            tiptap-outdent-action",(e=>{this.active=!1}))}on_click(e){super.on_click(e),this.editor.chain().focus().toggleOrderedList().run()}},extensions:[i.OrderedList,i.ListItem]},indent:{factory:class extends o{constructor(e,t){super(e,{container_elem:t.container_elem,icon:"indent-left",tooltip:"Indent"})}on_click(e){super.on_click(e),this.editor.chain().focus().setBlockquote().run()}},extensions:[i.Blockquote]},outdent:{factory:class extends o{constructor(e,t){super(e,{container_elem:t.container_elem,icon:"indent-right",tooltip:"Indent"})}on_click(e){super.on_click(e),this.editor.can().unsetBlockquote()&&(this.editor_elem.trigger(new $.Event("tiptap-outdent-action")),this.editor.chain().focus().unsetBlockquote().run())}},extensions:[i.Blockquote]},html:{factory:class extends o{constructor(e,t){super(e,{container_elem:t.container_elem,icon:"pencil",tooltip:"Edit HTML",toggle:!0}),this.parent=this.elem.closest("div.tiptap-editor"),this.editarea=$("div.ProseMirror",this.parent),this.textarea=$("textarea.ProseMirror",this.parent)}on_click(e){super.on_click(e),this.active?($("button",this.parent).not(this.elem).prop("disabled",!0),this.editarea.hide(),this.textarea.show().text(this.editor.getHTML())):($("button",this.parent).prop("disabled",!1),this.textarea.hide(),this.editarea.show(),this.editor.chain().focus().setContent(this.textarea.val()).run())}},extensions:[]},heading:{factory:class extends n{constructor(e,t){super(e,{container_elem:t.container_elem,icon:"font"}),this.children.push(new a(e,{container_elem:this.dd_elem}));for(let t=1;t<=6;t++)this.children.push(new l(e,{container_elem:this.dd_elem,level:t}));this.editor_elem.on("tiptap-bl-action tiptap-ol-action",(e=>{this.active_item=this.children[0]})),this.set_items()}},extensions:[i.Heading]},colors:{factory:class extends n{constructor(e,t){super(e,{container_elem:t.container_elem});for(let i of t.action_opts)this.children.push(new r(e,{container_elem:this.dd_elem,swatch:i}));this.set_items()}},extensions:[i.Color]},image:{factory:class extends n{constructor(e,t){super(e,{container_elem:t.container_elem,tooltip:"Add Image",icon:"picture",submit:!0}),this.src_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("src:")).append($('<input type="text" />')).prependTo(this.dd_elem),this.alt_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("alt:")).append($('<input type="text" />')).prependTo(this.dd_elem),this.title_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("title:")).append($('<input type="text" />')).prependTo(this.dd_elem)}submit(e){e.preventDefault(),this.editor.chain().focus().setImage({src:$("input",this.src_elem).val(),alt:$("input",this.alt_elem).val(),title:$("input",this.title_elem).val()}).run(),this.dd_elem.hide()}},extensions:[i.Image]},link:{factory:class extends n{constructor(e,t){super(e,{container_elem:t.container_elem,tooltip:"Add Link",icon:"link",submit:!0}),this.href_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("href:")).append($('<input type="text" />')).prependTo(this.dd_elem)}submit(e){e.preventDefault();let t=$("input",this.href_elem).val();this.editor.chain().focus().setLink({href:t}).run(),this.dd_elem.hide()}},extensions:[i.Link]}};class h{static initialize(e){t("div.tiptap-editor",e).each((function(){new h(t(this),{heading:!0,colors:[{name:"Default",color:"#333333"},{name:"Blue",color:"#1a21fb"},{name:"Lime",color:"#ccff00"},{name:"Teal",color:"#2acaea"},{name:"Red",color:"#d0060a"}],bold:{target:"text_controls"},italic:{target:"text_controls"},underline:{target:"text_controls"},bullet_list:{target:"format_controls"},ordered_list:{target:"format_controls"},indent:{target:"format_controls"},outdent:{target:"format_controls"},html:!0,image:!0,link:!0})}))}constructor(e,s={}){this.elem=e,this.elem.data("tiptap-widget",this);let o=new Set([i.Document,i.Paragraph,i.Text,i.TextStyle]);for(let e in s)d[e].extensions.forEach((e=>o.add(e)));this.editarea=t("div.ProseMirror",this.elem),this.textarea=t("<textarea />").addClass("ProseMirror").appendTo(this.elem),this.controls=t("<div />").addClass("tiptap-controls").prependTo(this.elem),this.editor=new i.Editor({element:this.elem[0],extensions:o,content:"<p>Hello World!</p>"}),this.buttons=[];let n=[];for(let e in s){let t=s[e],i=d[e].factory,o=t.target,l=this.controls;if(o){let e=n.filter((e=>e.name===o??!1));if(e[0])l=e[0].elem;else{let e=new c(o,this.controls);n.push(e),l=e.elem}}this.buttons.push(new i(this.editor,{action_opts:t,container_elem:l}))}this.hide_all=this.hide_all.bind(this),this.editor.on("update",this.hide_all)}destroy(){this.unload_all(),this.editor.destroy(),this.elem.empty(),this.buttons=null}unload_all(){this.buttons.forEach((e=>{e.unload&&e.unload()}))}hide_all(){t("div.tiptap-dropdown",this.elem).hide()}}t((function(){void 0!==window.ts?ts.ajax.register(h.initialize,!0):h.initialize()})),e.TiptapWidget=h,Object.defineProperty(e,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.tiptap=e}({},jQuery,tiptap);
//# sourceMappingURL=widget.min.js.map
