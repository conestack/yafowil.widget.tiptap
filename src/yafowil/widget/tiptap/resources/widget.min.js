!function(t,e,s){"use strict";class i{constructor(t,s){let i;this.elem=e("<div />").text(t).addClass("tiptap-tooltip").appendTo("body"),s.on("mouseover",(t=>{let e=`${s.offset().left+20}px`,o=`${s.offset().top+s.outerHeight()}px`;i=setTimeout((()=>{this.elem.css({left:e,top:o}),this.elem.fadeIn()}),500)})),s.on("mouseout",(t=>{clearTimeout(i),this.elem.fadeOut()}))}}class o{constructor(t,s,o,l){this.editor=t,this.elem=e("<button />").appendTo(o),l&&l.tooltip&&new i(l.tooltip,this.elem),l&&l.order&&this.elem.css("order",l.order),this.container_elem=o,this.opts=s,this.on_click=this.on_click.bind(this),this.elem.on("click",this.on_click)}toggle(){this.active=!this.active,this.active?this.elem.addClass("active"):this.elem.removeClass("active")}}class l extends o{constructor(t,e,s,i){super(t,e,s,i),this.elem.text(i.text).css(i.css)}}class n extends o{constructor(t,s,i,o){super(t,s,i,o),e("<i />").addClass(`glyphicon glyphicon-${o.btn_class}`).appendTo(this.elem)}}class d extends o{constructor(t,s,i){super(t,s,i),this.elem.addClass("drop_btn"),this.dd_elem=e("<div />").addClass("tiptap-dropdown").appendTo("body"),this.children=[],this.title=null,this.hide_dropdown=this.hide_dropdown.bind(this),e(document).on("click",this.hide_dropdown),this.on_resize=this.on_resize.bind(this),e(window).on("resize",this.on_resize)}get active_item(){return this._active_item}set active_item(t){let e=t.elem.children().clone();this.elem.empty().append(e),this.title&&this.elem.prepend(this.title),this.dd_elem.hide(),this._active_item=t}unload(){e(document).off("click",this.hide_dropdown),e(window).off("resize",this.on_resize)}on_resize(t){this.dd_elem.hide()}hide_dropdown(t){this.dd_elem.is(":visible")&&t.target!==this.dd_elem[0]&&t.target!==this.elem[0]&&0===e(t.target).closest(this.dd_elem).length&&0===e(t.target).closest(this.elem).length&&this.dd_elem.hide()}on_click(t){t.preventDefault();let s=this.elem.offset().left,i=this.elem.outerWidth(),o=this.dd_elem.outerWidth(),l=e(window).width()-s-i<o?s-o+i:s;this.dd_elem.css("left",`${l}px`).css("top",`${this.elem.offset().top+this.elem.outerHeight()}px`).toggle()}}class a extends o{constructor(t,e,s,i){super(t,e,s,i),this.level=i,$("<span />").text(`Heading ${this.level}`).appendTo(this.elem)}on_click(t){t.preventDefault(),this.editor.chain().focus().toggleHeading({level:this.level}).run()}}class r extends o{constructor(t,e,s){super(t,e,s),$("<span />").text("Text").appendTo(this.elem)}on_click(t){t.preventDefault(),this.editor.chain().focus().setParagraph().run()}}class c extends o{constructor(t,e,s,i){super(t,e,s,i),this.name=i.name,this.color=i.color,$("<span />").text(this.name).appendTo(this.elem),$("<div />").addClass("color").css("background-color",this.color).appendTo(this.elem)}on_click(t){t.preventDefault(),this.editor.chain().focus().setColor(this.color).run()}}let h={bold:{factory:class extends l{constructor(t,e,s){super(t,e,s,{text:"B",css:{"font-weight":"bold"},tooltip:"Toggle Bold"})}on_click(t){t.preventDefault(),this.toggle(),this.editor.chain().focus().toggleBold().run()}},extensions:[s.Bold],target:".text_controls"},italic:{factory:class extends l{constructor(t,e,s){super(t,e,s,{text:"i",css:{"font-style":"italic"},tooltip:"Toggle Italic"})}on_click(t){t.preventDefault(),this.toggle(),this.editor.chain().focus().toggleItalic().run()}},extensions:[s.Italic],target:".text_controls"},underline:{factory:class extends l{constructor(t,e,s){super(t,e,s,{text:"U",css:{"text-decoration":"underline"},tooltip:"Toggle Underline"})}on_click(t){t.preventDefault(),this.toggle(),this.editor.chain().focus().toggleUnderline().run()}},extensions:[s.Underline],target:".text_controls"},bullet_list:{factory:class extends o{constructor(t,e,s){super(t,e,s),this.elem.data("tiptap-bullet-list",this).append($("<i />").addClass("glyphicon glyphicon-list")),this.tooltip=new i("Bullet List",this.elem)}on_click(t){t.preventDefault();let e=$(".active",this.elem.parent()).data("tiptap-ordered-list");e&&(e.active=!1,e.elem.removeClass("active")),this.toggle(),this.editor.chain().focus().toggleBulletList().run()}},extensions:[s.BulletList,s.ListItem],target:".format_controls"},ordered_list:{factory:class extends o{constructor(t,e,s){super(t,e,s),this.elem.data("tiptap-ordered-list",this).append($("<i />").addClass("glyphicon glyphicon-th-list")),this.tooltip=new i("Ordered List",this.elem)}on_click(t){t.preventDefault();let e=$(".active",this.elem.parent()).data("tiptap-bullet-list");e&&(e.active=!1,e.elem.removeClass("active")),this.toggle(),this.editor.chain().focus().toggleOrderedList().run()}},extensions:[s.OrderedList,s.ListIte],target:".format_controls"},indent:{factory:class extends n{constructor(t,e,s){super(t,e,s,{btn_class:"indent-left",tooltip:"Indent"})}on_click(t){t.preventDefault(),this.editor.chain().focus().setBlockquote().run()}},extensions:[s.Blockquote],target:".format_controls"},outdent:{factory:class extends n{constructor(t,e,s){super(t,e,s,{btn_class:"indent-right",tooltip:"Indent"})}on_click(t){t.preventDefault(),this.editor.chain().focus().unsetBlockquote().run()}},extensions:[s.Blockquote],target:".format_controls"},html:{factory:class extends n{constructor(t,e,s){super(t,e,s,{btn_class:"pencil",tooltip:"Edit HTML",order:"5"}),this.parent=this.elem.closest("div.tiptap-editor"),this.editarea=$("div.ProseMirror",this.parent),this.textarea=$("textarea.ProseMirror",this.parent)}on_click(t){t.preventDefault(),this.toggle(),this.active?($("button",this.parent).not(this.elem).prop("disabled",!0),this.editarea.hide(),this.textarea.show().text(this.editor.getHTML())):($("button",this.parent).prop("disabled",!1),this.textarea.hide(),this.editarea.show(),this.editor.chain().focus().setContent(this.textarea.val()).run())}},extensions:[]},heading:{factory:class extends d{constructor(t,e,s){super(t,e,s),this.title=$("<i />").addClass("glyphicon glyphicon-font"),this.elem.css("order","1"),this.children.push(new r(t,e,this.dd_elem));for(let s=1;s<=6;s++)this.children.push(new a(t,e,this.dd_elem,s));for(let t of this.children)t.elem.addClass("dropdown-item"),t.elem.on("click",(e=>{this.active_item=t}));this.active_item=this.children[0]}},extensions:[s.Heading]},colors:{factory:class extends d{constructor(t,e,s){super(t,e,s),this.elem.css("order","2");for(let s of e)this.children.push(new c(t,e,this.dd_elem,s));for(let t of this.children)t.elem.addClass("dropdown-item"),t.elem.on("click",(e=>{this.active_item=t}));this.active_item=this.children[0]}},extensions:[s.Color]},image:{factory:class extends d{constructor(t,e,s){super(t,e,s),this.tooltip=new i("Add image",this.elem),this.elem.append($("<i />").addClass("glyphicon glyphicon-picture")).css("order","7"),this.dd_elem.addClass("grid"),this.src_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("src:")).append($('<input type="text" />')).appendTo(this.dd_elem),this.alt_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("alt:")).append($('<input type="text" />')).appendTo(this.dd_elem),this.title_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("title:")).append($('<input type="text" />')).appendTo(this.dd_elem),this.submit_elem=$("<button />").addClass("submit").text("submit").appendTo(this.dd_elem),this.submit=this.submit.bind(this),this.submit_elem.on("click",this.submit)}submit(t){t.preventDefault(),this.editor.chain().focus().setImage({src:$("input",this.src_elem).val(),alt:$("input",this.alt_elem).val(),title:$("input",this.title_elem).val()}).run(),this.dd_elem.hide()}},extensions:[s.Image]},link:{factory:class extends d{constructor(t,e,s){super(t,e,s),this.tooltip=new i("Add link",this.elem),this.elem.append($("<i />").addClass("glyphicon glyphicon-link")).css("order","6"),this.dd_elem.addClass("grid"),this.href_elem=$("<span />").addClass("dropdown-item").append($("<span />").addClass("name").text("href:")).append($('<input type="text" />')).appendTo(this.dd_elem),this.submit_elem=$("<button />").addClass("submit").text("submit").appendTo(this.dd_elem),this.submit=this.submit.bind(this),this.submit_elem.on("click",this.submit)}submit(t){t.preventDefault();let e=$("input",this.href_elem).val();this.editor.chain().focus().setLink({href:e}).run(),this.dd_elem.hide()}},extensions:[s.Link]}};class p{static initialize(t){e("div.tiptap-editor",t).each((function(){new p(e(this),{bold:!0,italic:!0,underline:!0,bullet_list:!0,ordered_list:!0,indent:!0,outdent:!0,html:!0,heading:!0,colors:[{name:"Default",color:"#333333"},{name:"Blue",color:"#1a21fb"},{name:"Lime",color:"#ccff00"},{name:"Teal",color:"#2acaea"},{name:"Red",color:"#d0060a"}],image:!0,link:!0})}))}constructor(t,i={}){this.elem=t,this.elem.data("tiptap-widget",this);let o=new Set([s.Document,s.Paragraph,s.Text,s.TextStyle]);for(let t in i)h[t].extensions.forEach((t=>o.add(t)));this.editarea=e("div.ProseMirror",this.elem),this.textarea=e("<textarea />").addClass("ProseMirror").appendTo(this.elem),this.controls=e("<div />").addClass("tiptap-controls").prependTo(this.elem),i.bold|i.italic|i.underline&&(this.text_controls=e("<div />").addClass("btn-group text_controls").css("order","3").appendTo(this.controls)),i.bullet_list|i.ordered_list|i.indent|i.outdent&&(this.format_controls=e("<div />").addClass("btn-group format_controls").css("order","4").appendTo(this.controls)),this.editor=new s.Editor({element:this.elem[0],extensions:o,content:"<p>Hello World!</p>"}),this.buttons=[];for(let t in i){let s=i[t],o=h[t].factory,l=h[t].target,n=l?e(l,this.controls):this.controls;this.buttons.push(new o(this.editor,s,n))}this.hide_all=this.hide_all.bind(this),this.editor.on("update",this.hide_all)}destroy(){this.unload_all(),this.editor.destroy(),this.elem.empty(),this.buttons=null}unload_all(){this.buttons.forEach((t=>{t.unload&&t.unload()}))}hide_all(){e("div.tiptap-dropdown",this.elem).hide()}}e((function(){void 0!==window.ts?ts.ajax.register(p.initialize,!0):p.initialize()})),t.TiptapWidget=p,Object.defineProperty(t,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.tiptap=t}({},jQuery,tiptap);
//# sourceMappingURL=widget.min.js.map
